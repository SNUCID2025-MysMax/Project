name = "Scenario1"
cron = "0 9 * * *"
period = 100
phase := 0
open_count := 0
open_time_1 := 0.0
open_time_2 := 0.0
blind_open_time := 0.0
alarm_triggered := false
open_duration := 0
blink_timer := 0

if (phase == 0) {
  if ((#Light).switch_switch == 'off' and (#Window).windowControl_window == 'closed')) {
    (#Blind).blind_open()
    blind_open_time = (#Clock).clock_timestamp
    phase = 1
  }
}

if (phase == 1) {
  if ((#Window).windowControl_window == 'open') {
    open_count = open_count + 1
    if (open_count == 1) {
      open_time_1 = (#Clock).clock_timestamp
    } else if (open_count == 2) {
      open_time_2 = (#Clock).clock_timestamp
    }
    phase = 2
    blink_timer = 0
    open_duration = 0
  }
}

if (phase == 2) {
  blink_timer = blink_timer + 100
  if ((#Window).windowControl_window == 'open') {
    open_duration = open_duration + 100
  } else {
    open_duration = 0
  }

  if (blink_timer >= 5000 and alarm_triggered == false) {
    (#Alarm).alarm_siren()
    alarm_triggered = true
  }

  if (alarm_triggered and open_duration >= 10000) {
    (#Light).switch_toggle()
    (#Clock).clock_delay(0, 0, 2)
    (#Light).switch_toggle()
  }

  if ((#Window).windowControl_window == 'closed') {
    phase = 3
  }
}

if (phase == 3) {
  if ((open_count >= 2) and (open_time_2 > open_time_1)) {
    (#AirConditioner).switch_off()
  }
  break
}
